# 操作系统引论

# 操作系统引论

## 操作系统的目标和作用

### 概念

- 是指控制和管理整个计算机系统的硬件与软件资源，合理地组织，调度计算机的工作与资源的分配，进而为用户和其他软件提供方便接口与环境的程序集合
- 操作系统控制和协调各用户的应用程序对硬件的分配与使用

### 作为系统资源的管理者

- 提供的功能

  - 处理机管理

    - 管理负责处理机的分配与控制
  - 存储器管理

    - 负责内存的分配与回收
  - 文件管理

    - 负责文件的存取，共享与保护
  - 设备管理

    - 完成用户的I/O请求，方便用户使用各种设备，并提高设备的利用率，主要包括缓冲管理，设备分配，设备处理和虚拟设备等功能
- 目标

  - 安全，高效

### 作为用户和计算机硬件之间的接口

- 提供的功能

  - 命令接口

    - 联机命令接口

      - 用户说一句，系统做一句
      - 又被称为交互式命令接口
    - 脱机命令接口

      - 用户说一堆，系统做一堆
      - 又被称为批处理命令接口
    - 允许用户直接使用
  - 程序接口

    - 允许用户通过程序间接使用
    - 由一组系统调用组成（程序接口=系统调用）
  - GUI（图形用户界面）

    - 现代操作系统中最流行的图形用户接口
- 目标

  - 方便用户使用

### 实现了对计算机资源的抽象

- 对硬件机器的扩展
- 扩充机器

### 目标

- 方便性
- 有效性
- 可扩展性
- 开放性

## 操作系统特征

### 并发

- 并发

  - 指两个或多个事件在同一时间间隔内发生。这些事件宏观上是同时发生的，但微观上是交替发生的。
- 并行

  - 指两个或多个事件在同一时刻同时发生
- 操作系统的并发性指计算机系统中同时存在着多个运行着的程序
- 操作系统和程序并发是一起诞生的

### 共享

- 两种资源共享方式

  - 互斥共享方式

    - 系统中的某些资源，虽然可以提供给多个进程使用，但一个时间段内只允许一个进程访问该资源
  - 同时共享方式

    - 系统中的某些资源，允许一个时间段内由多个进程“同时”对它们进行访问
    - 所谓的“同时”往往是宏观上的，而在微观上，这些进程可能是交替地对该资源进行访问的（即分时共享）
- 共享性是指系统中的资源可供内存中多个并发执行的进程共同使用

### 虚拟

- 指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而在逻辑上对应物（后者）是用户感受到的
- 虚拟技术

  - 空分复用技术
  - 时分复用技术

    - 虚拟处理机技术
    - 虚拟设备技术
- 如果失去了并发性，则一个时间段内系统中只需要运行一道程序，那么就失去了实现虚拟性的意义。因此，没有并发性，就谈不上虚拟性

### 异步

- 在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性
- 只有系统拥有并发性，才有可能导致异步性

### 没有并发和共享，就谈不上虚拟和异步，因此并发和共享是操作系统的两个最基本的特征

## 操作系统的发展过程

### 手工操作阶段

- 主要缺点

  - 用户独占主机
  - CPU等待人工操作

    - 导致资源利用率极低

### 脱机I/O方式

- 目的

  - 为了解决人机矛盾以及CPU与I/O设备之间速度不匹配的矛盾

### 单道批处理系统

- 引入了脱机输入/输出技术（用磁带完成）,并监督程序负责控制作业的输入，输出
- 主要优点

  - 减少了CPU的空闲时间
  - 提高了I/O速度
- 主要缺点

  - 内存中仅能有一道程序运行
  - CPU有大量的时间是在空闲等待I/O完成

### 多道批处理系统

- 后备队列

  - 用户所提交的作业会被先存放在外存上，并排成一个队列
- 主要优点

  - 资源利用率高
  - 系统吞吐量大
  - 平均周转时间长
  - 无交互能力
- 主要缺点

  - 用户响应时间长
  - 没有人机交互功能

### 分时系统

- 计算机以时间片为单位轮流为各个用户/作业服务
- 主要优点

  - 及时接收
  - 及时处理
- 主要缺点

  - 不能处理一些紧急任务
- 特征

  - 多路性
  - 独立性
  - 及时性
  - 交互性

### 实时系统

- 实时是指及时
- 指系统能够及时响应外部事件的请求，在规定的时间内完成对该事件的处理，并控制所有实时任务协调一致的运行
- 分类

  - 硬实时系统

    - 必须在绝对严格的规定时间内完成处理
  - 软实时系统

    - 能接受偶尔违反时间规定
- 实时任务的类型

  - 周期性实时任务
  - 非周期性实时任务
  - 硬实时任务
  - 软实时任务

### 微机操作系统

### 嵌入式操作系统

### 网络操作系统

### 分布式操作系统

## OS的运行机制和体系结构

### 运行机制

- 两种指令

  指令：处理器能够识别，执行的最基本的命令

  - 特权指令

    - 内存清零
    - 执行启动外部设备
    - 设置系统时钟时间
    - 关中断
    - 切换执行状态
  - 非特权指令
- 两种处理器状态

  - 用户态（目态）

    - 此时的CPU只能执行非特权指令
  - 核心态（管态/系统态）

    - 特权指令，非特权指令都能执行
  - 用程序状态寄存器（PSW）中的某标志位来标识当前处理器处于什么状态。如0为用户态，1为核心态
- 两种程序

  - 内核程序

    - 操作系统的内核程序是系统的管理者，既可以执行特权指令，也可以执行非特权指令，运行在核心态
  - 应用程序

    - 为了保证系统能安全运行，普通应用程序只能执行非特权指令，运行在用户态

### 操作系统内核

- 时钟管理

  - 实现计时功能
- 中断处理

  - 负责实现中断机制
- 原语

  - 由若干条指令组成的，用于完成一定功能的一个过程
  - 是一种特殊的程序
  - 处于操作系统最底层，是最接近硬件的部分
  - 这种程序的运行具有原子性——其运行只能一气呵成，不可中断
  - 运行时间较短，调用频繁
- 资源管理功能

  - 进程管理
  - 存储器管理
  - 设备管理

### 操作系统的主要功能

- 处理机管理功能

  - 进程控制
  - 进程同步
  - 进程通信
  - 调度
- 存储器管理

  - 内存分配和回收

    - 静态分配
    - 动态分配
  - 内存保护
  - 地址映射
  - 内存扩充

    - 请求调入功能
    - 置换功能
- 设备管理

  - 缓冲管理
  - 设备分配
  - 设备处理
- 文件管理功能

  - 文件存储空间管理
  - 目录管理
  - 文件的读/写管理和保护
- 接口管理功能

  - 用户接口
  - 联机用户接口
  - 脱机用户接口
  - 图形用户接口
  - 程序接口

### 操作系统的体系结构

- 大内核

  - 将操作系统的主要功能模块都作为系统内核，运行在核心态
  - 优点

    - 高性能
  - 缺点

    - 内核代码庞大，结构混乱，难以维护
- 微内核

  - 只把最基本的功能保留在内核
  - 优点

    - 内核功能少，结构清晰，方便维护
  - 缺点

    - 需要频繁地在核心态和用户态之间切换，性能低

## 中断和异常

### 中断机制的诞生

### 中断机制的概念和作用

- 使CPU从用户态切换为核心态，使操作系统获得计算机的控制权
- 用户态到核心态是通过中断实现的，且中断是唯一途径
- 核心态到用户态的切换是通过执行一个特权指令，将PSW的标志位设置为用户态

### 中断的分类

- 内中断（也称为“异常，例外，陷入”）

  - 信号的来源：CPU内部，与当前执行的指令有关
  - 自愿中断——指令中断
  - 强迫中断

    - 硬件故障
    - 软件中断
- 外中断

  - 信号的来源：CPU外部，与当前执行的指令有关
  - 外设请求
  - 人工干预

### 外中断的处理过程
