# 磁盘管理

# 磁盘管理

## 磁盘的结构

### 磁盘、磁道、扇区的概念

- 磁盘由表面涂有磁性物质的圆形盘片组成
- 每个盘片被划分为一个个磁道，每个磁道又划分为一个个扇区

### 如何在磁盘中读/写数据

- 磁头移动到目标位置，盘片旋转，对应扇区划过磁道才能完成读/写

### 盘面、柱面的概念

- 磁盘有多个盘片“摞”起来，每个盘片有两个盘面
- 所有盘面中相对位置相同的磁道组成柱面

### 磁盘的物理地址

- （柱面号，盘面号，扇区号）

### 磁盘的分类

- 根据磁头是否可移动

  - 固定头磁盘（每个磁道有一个磁头）
  - 移动头磁盘（每个盘面只有一个磁头）
- 根据盘片是否可更换

  - 固定盘磁盘
  - 可换盘磁盘

## 磁盘调度算法

### 一次磁盘读/写操作需要的时间

- 寻找时间(寻道时间)：启动磁臂
- 移动磁头所花的时间
- 延迟时间：将目标扇区转到磁头下面所花的时间
- 传输时间：读/写数据花费的时间

### 磁盘调度算法

- 先来先服务（FCFS）

  - 按访问请求到达的先后顺序进行处理
- 最短寻找时间优先（SSTF)

  - 每次都优先响应距离磁头最近的磁道访问请求
  - 贪心算法的思想，能保证眼前最优，但无法保证总的寻道时间最短
  - 缺点：可能导致饥饿
- 扫描算法(SCAN)

  - 只有磁头移动到最边缘的磁道时才可以改变磁头移动方向
  - 缺点：对各个位置磁道的响应频率不平均
- 循环扫描算法(C-SCAN)

  - 只有磁头朝某个方向移动时才会响应请求，移动到边缘后立即让磁头返回起点，返回途中不响应任何请求
- LOOK算法

  - SCAN算法的改进，只要在磁头移动方向上不再有请求，就立即改变磁头方向
- C-LOOK算法

  - C-SCAN算法的改进，只要在磁头移动方向上不再有请求，就立即让磁头返回

## 减少延迟的方法

### 交替编号

- 具体做法：让编号相邻的扇区在物理上不相邻
- 原理：读取完一个扇区后需要一段时间处理才可以继续读入下一个扇区

### 错位命名

- 具体做法：让相邻盘面的扇区编号“错位"
- 原理：与"交替编号"的原理相同。“错位命名法”可降低延迟时间

### 磁盘地址结构的设计

- 理解为什么要用（柱面号，盘面号，扇区号）的结构
- 理解为什么不用（盘面号，柱面号，扇区号）的结构
- 原因：在读取地址连续的磁盘块时，前者更不需要移动磁头

## 磁盘管理

### 磁盘初始化

- 低级格式化/物理格式化：划分扇区
- 磁盘分区（C盘、D盘、E盘）
- 逻辑格式化：建立文件系统（建立根目录文件、建立用于存储空间管理的数据结构）

### 引导块

- 计算机启动时需要运行初始化程序(自举程序）来完成初始化
- ROM中存放很小的自举装入程序
- 完整的自举程序存放在初始块(引导块）中

### 坏块的管理

- 简单的磁盘：逻辑格式化时将坏块标记出来
- 复杂的磁盘：磁盘控制器维护一个坏块链，并管理备用扇区

## 固态硬盘SSD

### 原理

- 一基于闪存技术Flash Memory,属于电可擦除ROM,即EEPROM

### 组成

- 闪存翻译层

  - -负责翻译逻辑块号，找到对应页（Page)
- 存储介质：多个闪存芯片（Flash Chip)

  - 一每个芯片包含多个块（block）

    - 每个块包含多个页(page)

### 读写性能特性

- 以页(page)为单位读/写—相当于磁盘的“扇区"
- 以块（block）为单位“擦除”，擦干净的块，其中的每页都可以写一次，读无限次
- 支持随机访问，系统给定一个逻辑地址，闪存翻译层可通过电路迅速定位到对应的物理地址
- 读快、写慢。要写的页如果有数据，则不能写入，需要将块内其他页全部复制到一个新的（擦除过的）块中，再写入新的页

### 与机械硬盘相比的特点

- SSD读写速度快，随机访问性能高，用电路控制访问位置；机械硬盘
- 通过移动磁臂旋转磁盘控制访问位置，有寻道时间和旋转延迟
- SSD安静无噪音、耐摔抗震、能耗低、造价更贵
- SSD的一个“块”被擦除次数过多（重复写同一个块）可能会坏掉，而机械硬盘的扇区不会因为写的次数太多而坏掉

### 磨损均衡技术

- 思想：将“擦除”平均分布在各个块上，以提升使用寿命
- 动态磨损均衡一

  - -写入数据时，优先选择累计擦除次数少的新闪存块
- 静态磨损均衡―

  - SSD监测并自动进行数据分配、迁移，让老旧的闪存块承担以读为主的储存任务，让较新的闪存块承担更多的写任务
