# 第一章 概述

## 1.1 计算机网络在信息时代中的作用

21世纪的一些重要特征

> 数字化，网络化和信息化
>
> 以网络为核心的信息时代

互联网的两个重要基本特点

- 连通性
- 共享（资源共享）

## 1.2 互联网概述

计算机网络由若干个结点货连接这些结点的链路组成



网络把许多计算机连接在一起，二互联网则把许多网络通过路由器连接在一起。与网络相连的计算机常称为主机



Internet和internet的区别

- internet（互连网）是一个通用名词，它泛指由多个计算机网络互连而成的计算机网络
- Internet（互联网，或因特网）则是一个专用名词，它指当前全球最大的，开放的，由众多网络相互连接而成的特定互联网，它采用TCP/IP协议族作为通信的规则，且其前身是美国的ARPANET

## 1.3互联网的组成

计算机之间通信：主机A的某个进场和主机B上的另一个进场进行通信



在网络边缘的端系统之间的通信方式通常课划分为两大类

- 客户-服务器方式（C/S方式）

    客户是服务请求方，服务器是服务提供方

- 对等方式（P2P方式）



路由器是实现分组交换的关键构件，其任务是转发收到的分组



- 电路交换（Circuit Switching）

    - 电话交换机接通电话线的方式成为电路交换
    - 从通信资源的分配角度来看，交换（Switching）就是按照某种方式动态地分配传输线路的资源
    - 电路交换的三个步骤
        - 建立连接（分配通信资源）
        - 通话（一直占用通信资源）
        - 释放连接（归还通信资源）
    - 特点
        - 在通话的全部时间内，通话的两个用户始终占用端到端的通信资源
        - 当使用电路交换来传送计算机数据时，其线路的传输效率往往很低

    ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E7%94%B5%E8%B7%AF%E4%BA%A4%E6%8D%A2.png)

- 分组交换（Packet Switching）

    - 优点
        - 高效
            - 在分组传输的过程中动态哦分配传输带宽，对通信链路是逐段占用
        - 灵活
            - 为每一个分组独立地选择最合适的转发路由
        - 迅速
            - 以分组作为传送单位，可以不先建立连接就能向其他主机发送分组
        - 可靠
            - 保证可靠性网络协议，分布式多路由的分组交换网，使网络有很好的生存性

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%B8%89%E7%A7%8D%E4%BA%A4%E6%8D%A2%E7%9A%84%E6%AF%94%E8%BE%83.png)

<img src="https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%B8%89%E7%A7%8D%E4%BA%A4%E6%8D%A2%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9.png" style="zoom:200%;" />

## 1.6 计算机网络的性能

> 比特
>
> 计算机中数据量的单位，也是信息论中信息量的单位。一个比特就是二进制数字中的一个1或0
>
> 
>
> 常用数据单位
>
> ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E9%80%9F%E7%8E%87%E6%95%B0%E6%8D%AE%E5%8D%95%E4%BD%8D.png)



- 速率

    > 速率：数据的传送速率，即数据率/比特率

    - 常用数据单位

        ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E9%80%9F%E7%8E%87%E6%95%B0%E6%8D%AE%E5%8D%95%E4%BD%8D1.png)

- 带宽

    - 在模拟信号系统中的意义
        - 信号所包含的各种不同频率成分所占据的频率范围
        - 单位：HZ （KHz，MHz，GHz）
            - 带宽3.1KHz（300Hz ~ 3.4kHz）话音的主要成分的频率范围
    - 在计算机网络中的意义
        - 用来表示网络的通信线路所能传送数据的能力，因此网络带宽表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”
        - 单位： b/s (kb/s,Mb/s,Gb/s,Tb/s)

- 吞吐量

    - 表示在单位时间内通过某个网络（或信道，接口）实际的数据量
    - 受网络的带宽或网络的额定速率的限制

- 时延

    - 是指数据（一个报文或分组，甚至比特）从网络（或链路）的一端传送到另一端所需的时间

    - 发送时延

        - 是主机或路由器发送数据帧所需要的时间，即从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间

        - $$
            发送时延 = \frac{数据帧长度(bit)}{发送速率(bit/s)}
            $$

    - 传播时延

        - 是电磁波在信道中传播一定的距离需要花费的时间

        - $$
            {\color{Green}传播时延 = \frac{信道长度(m)}{电磁波在信道上的传播速率(m/s)}}
            $$

        - > 电磁波在自由空间的传播速率是光速(3.0*10^3km/s)
            >
            > 在网络传输媒体中的传播速率比在自由空间要略低一些
            >
            > 在铜线电缆中的传播速率约为2.3*10^5 km/s
            >
            > 在光纤中的传播速率约为2.0*10^5 km/s

    - 处理时延

        - 主机或路由器在收到分组时要花费一定的时间进行处理
        - 几种情况
            - 分析分组的首部
            - 从分组中提取数据部分
            - 进行差错检验
            - 查找适当的路由

    - 排队时延

        - 分组在经过网络传输时。要经过许多路由器。但分组在进入路由器要先在输入队列中排队等待处理
        - 排队时延的长短往往取决于网络当时的通信量

    - $$
        {\color{Green}总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延}
        $$

    - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%87%A0%E7%A7%8D%E6%97%B6%E5%BB%B6%E4%BA%A7%E7%94%9F%E7%9A%84%E5%9C%B0%E6%96%B9.png)

    - 发送时延发生在机器内部的发送器中（一般是网络适配器中），与传输信道的长度（或信号传送的距离）没有任何关系。但传播时延则发生在机器外部的传输信道媒体上，而与信号的发送速率无关。信号传送的距离越远，传播时延就越大

- 时延带宽积

    - $$
        时延带宽积 = 传播时延 * 带宽
        $$

    ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%97%B6%E5%BB%B6%E5%B8%A6%E5%AE%BD%E7%A7%AF.png)

- 往返时间RTT

    - $$
        {\color{Green}发送时间 = \frac{数据长度}{发送速率}}\\
        {\color{Green}有效数据率 = \frac{数据长度}{发送时间+RTT}}
        $$

    - RTT还包括各中间结点的处理时延，排队时延，一级转发数据时的发送时延

- 利用率

    - 信道利用率

        - 某信道有百分之几的时间是被利用的（有数据通过）

    - 网络利用率

        - 全网络的信道利用率的加权平均值

    - $$
        {\color{Green}令D_0表示网络空闲时的时延，D表示网络当前的时延，U表示利用率，那么在适当的假定条件下} \\
        {\color{Green}D = \frac{D_0}{1-U}}
        $$

    - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%97%B6%E5%BB%B6%E4%B8%8E%E5%88%A9%E7%94%A8%E7%8E%87%E7%9A%84%E5%85%B3%E7%B3%BB.png)

    - 信道或网络的利用率过高会产生非常大的时延

- 丢包率

## 1.7 计算机网络体系结构

## 1.7.1 计算机网络体系结构的形成

- OSI标准失败的原因
    - OSI的专家们缺乏实际经验，他们在完成OSI标椎时缺乏商业驱动
    - OSI的协议实现起来过分复杂，而且运行效率很低
    - OSI标准的制定周期太长，因而使得按OSI标准生产的设备无法及时进入市场
    - OSI的层次划分不太合理。有些功能在多个层次中重复出现

## 1.7.2 协议与划分层次

网络协议：为进行网络中的数据交换而建立的规则，标椎或约定

- 网络协议主要由以下三要素组成
    - 语法，即数据与控制信息的结构或格式
    - 语义，即需要发出何种控制信息，完成何种动作以及做出何种响应
    - 同步，即事件实现顺序的详细说明
- 分层的好处
    - 灵活性好
    - 结构上可分割
    - 易于实现和维护
    - 能促进标椎化工作

## 1.7.3 具有五层协议的体系结构

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png)

- 应用层（application layer）

    - 最高层

    - 任务

        - 通过应用进程间的交互来完成特定网络应用

    - 定义

        - 应用进程间的通信和交互的规则

            [^进程]: 主机中正在运行的程序

    - 把应用层交互的数据单元称为报文

- 运输层（transport layer）

    - 任务
        - 负责向两台主机中进程之间的通信提供通用的数据传输服务
    - 功能
        - 复用
            - 多个应用层进程课同时使用下面运输层的服务
        - 分用
            - 运输层把收到的信息分班交付上面应用层中的相应进程
    - 主要使用协议
        - 传输控制协议TCP
            - 提供面向连接的，可靠的数据传输服务，其数据传输的单位是报文段
        - 用户数据报协议UDP
            - 提供无连接的，尽最大努力的数据传输服务（不保证数据传输的可靠性），其数据传输的单位是用户数据报

- 网络层（network layer）

    - 任务
        - 负责为分组交换网上的不同主机提供通信服务
        - 选择合适的路由
    - 协议
        - IP协议

- 数据链路层（data link layer）

- 物理层（physical layer）

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%95%B0%E6%8D%AE%E5%9C%A8%E5%90%84%E5%B1%82%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BC%A0%E9%80%92%E8%BF%87%E7%A8%8B.png)

## 1.7.4 实体，协议，服务和服务访问点

- 实体
    - 表示任何发送或接收信息的硬件或软件进程
- 协议
    - 是控制两个对等实体（或多个实体）进行通信的规则的集合

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E7%9B%B8%E9%82%BB%E4%B8%A4%E5%B1%82%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB.png)

- 协议数据单元PDU
    - 对等层次之间传送的数据包称为该层的协议数据单元
- 服务数据单元SDU
    - 同一系统内，层与层之间交换的数据包称为服务数据单元
- 多个SDU可以合成一个PDU，一个SDU也可以划分为几个PDU

## 第一章习题

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/OSI%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B%E6%AF%8F%E5%B1%82%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%BD%9C%E7%94%A8%E8%8C%83%E5%9B%B4.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/TCPIP%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B.png)

# 第二章 物理层

## 2.1 物理层的基本概念

> 物理层考虑的是**怎样才能在连接各种就算机的传输媒体上传输数据比特流，而不是指具体的传输媒体**

物理层的主要任务描述为确定与传输媒体的接口有关的一些特性

- 机械特性
    - 指明接口所用接线器的形状和尺寸，引脚数目和排列，固定和锁定装置
- 电气特性
    - 指明在接口电缆的各条线上出现的电压范围
- 功能特性
    - 指明某条线上出现的某一电平的电压的意义
- 过程特性
    - 指明对于不同功能的各种可能事件的出现顺序

> 数据在计算机内部多采用并行传输方式，在通信线路上一般是串行传输（即逐个比特按照时间顺序传输），因此物理层还要完成传输方式的转换

## 2.2 数据通信的基础知识

### 2.2.1 数据通信系统的模型

 ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E7%B3%BB%E7%BB%9F.png)![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A8%A1%E5%9E%8B.png)

> 通信的目的是消息，数据是运送消息的实体，信号则是数据的电气或电磁的表现
>
> 数据是使用特定方式表示的信息，通常是有意义的符号序列



根据信号中代表信息的参数的取值方式不同，信号可以分为两大类

- 模拟信号，或连续信号
    - 代表消息的参数的取值是连续的
- 数字信号，或离散信号
    - 代表消息的参数的取值是离散的
    - 在使用时间域的波形表示数字信号时，代表不同离散数字的基本波形就称为**码元**

> 一个码元所携带的信息量是不固定的，而是由调制方式和编码方式决定的

### 2.2.2 有关信道的几个基本概念

- 信道
    - 一般都是用来表示向某一个方向传送的媒体
    - 一条通信电路往往包含一条发送信道和一条接收信道

从通信的双方交互方式来看，可以有以下三种基本方式

- 单向通信（单工通信）
    - 只能有一个方向的通信而没有反方向的交互
    - 无线广播，有线广播，电视广播
- 双向交替通信 （半双工通信）
    - 通信的双方都可以发送消息，但不能双方同时接受/发送
- 双向同时通信 （全双工通信）
    - 通信的双方可以同时发送和接受信息



基带信号（基本频带信号）

- 来自信源的信号
- 例如计算机输出的代表各种文字或图像文件的数据信号
- 因为往往包含较多的低频成分，甚至有直流成分，而许多信道不能传输这些，因此需要对其进行调制

------

- 调制
    - 基带调制（编码）
        - 仅仅对基带信号的波形进行变换，使它能够与信道特性相适应
            - 变换后仍然是基带信号
    - 带通调制
        - 使用载波进行调制，把基带信号的频率范围搬移到较高的频段，并转换为模拟信号

------

常用编码方式

- 不归零制
    - 正电平代表1，负电平代表0
    - 需要额外一条传输线来传输时钟信号，使发送方和接收方同步
    - 存在同步问题
- 归零制
    - 正脉冲代表1，负脉冲代表0
    - 每个码元传输结束后都要“归零”，所以接收方只要在信号归零后采样即可，不需要单独的时钟信号
    - 实际上，归零编码相当于把时钟信号用“归零”方式编码在了解数据之内，这称为“自同步”信号
    - 但是归零编码中大部分的数据带宽，都用来传输“归零”而浪费掉了
    - 自同步，编码效率低 
- 曼彻斯特编码
    - 位周期中心的向上跳代表0，位周期中心的向下跳代表1，但也可以反过来定义
- 差分曼彻斯特编码
    - 在每一位的中心处始终都有跳代表变。位开始边界有跳变代表0，而位开始边界没有跳代表1

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%95%B0%E5%AD%97%E4%BF%A1%E5%8F%B7%E5%B8%B8%E7%94%A8%E7%9A%84%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F.png)

> 从信号波形中可以看出，曼彻斯特(Manchester)编码产生的信号频率比不归零制高。从自同步能力来看，不归零制不能从信号波形本身中提取信号时钟频率（这叫做没有自同步能力），而曼彻斯特编码具有自同步能力。

基本的带通调制方法

<img src="https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%E4%B8%89%E7%A7%8D%E8%B0%83%E5%88%B6%E6%96%B9%E6%B3%95.png" style="zoom:200%;" />

- 调幅（AM）
    - 载波的振幅随基带数字信号而变化
    - 0或1分别对应于无载波或有载波输出
- 调频（FM）
    - 载波的频率随基带数字信号而变化
    - 0或1分别对应于频率${f_1}$或${f_2}$
- 调相（PM）
    - 载波的初始相位随基带数字信号而变化
    - 0或1分别对应于相位0度或180度

### 2.2.3 信道的极限容量

![](images\信号波形失真.png)

信号波形失真因素

- 码元传输速率
- 信号传输距离
- 噪声干扰
- 传输媒体质量

------

奈氏准则

> 在假定的理想条件下，为了避免码间串扰，码元传输速率是有上限的

- 理想低通信道的最高码元传输速率 = 2W Baud = 2W 码元/秒
- 理想带通信道的最高码元传输速率 =   W Baud =   W 码元/秒
    - W;	信道带宽（单位为Hz）
    - Baud：波特，即码元/秒
- 码元传输速率又称为波特率，调制速率，波形速率或符号速率。它与比特率有一定的关系
    - 当1个码元只携带1比特的信息量时，则波特率（码元/秒）与比特率（比特/秒）在数值上是想等的
    - 当1个码元携带n比特的信息量时，则波特率（码元/秒）换成比特率（比特/秒）时，数值要乘以n
- 要提高信息传输速率（比特率），就必须设法使每一个码元能携带更多个比特的信息量。这需要采用多元制
- 实际的信道所能传输的最高码元速率，要明显地域奈氏准则给出的这个上限数值
- 在任何信道中，码元传输的速率是有上限的，传输速率超过此上限，就会出现严重的码间串扰的问题，使接收端对码元的判决（即识别）成为不可能。

------

信噪比

> 是信号的平均功率和噪声的平均功率之比，常记为${S/N}$,并用分贝（dB）作为度量单位，即
> $$
> 信噪比(dB) = 10 \log_{10}(S/N) (dB)
> $$

香农公式

> 带宽受限且有高斯白噪声干扰的信道的极限信息传输速率
> $$
> {\color{Green}c = W \times log_{2}(1+\frac{S}{N}) } \\
> \begin{align}
> &c：信道的极限信息传输速率 （单位：b/s）\\
> &W：信道带宽（单位：Hz）\\
> &S：信道内所传信号的平均功率 \\
> &N：信道内的高斯噪声功率 \\
> &S/N：信噪比，使用分贝(dB)作为度量单位 \\
> &信噪比(dB) = 10 \log_{10}(S/N) (dB)
> \end{align}
> $$

- 信道带宽或信道中的信噪比越大，信息的极限传输速率越高 
- 在实际信道上信道能够达到信息传输速率要比该公式的极限传输速率低不少。这是因为在实际信道中，信号还要受到其他一些损伤，入各种脉冲干扰，信号在传输中的衰减和失真等，这些因素在香农公式中并未考虑

## 2.3 物理层下面的传输媒体

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E7%94%B5%E4%BF%A1%E9%9B%B6%E7%8E%87%E4%BD%BF%E7%94%A8%E7%9A%84%E7%94%B5%E7%A3%81%E6%B3%A2%E7%9A%84%E9%A2%91%E8%B0%B1.png)

传输媒体

- 导引型传输媒体
    - **电磁波被导引沿着固体媒体传播**
    - 双绞线
        - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%8F%8C%E7%BB%9E%E7%BA%BF%E7%9A%84%E7%A4%BA%E6%84%8F%E5%9B%BE.png)
        - 屏蔽层主要为了提高双绞线抗电磁干扰的能力（STP，没有屏蔽层的是UTP）
        - 绞合的作用
            - 低于部分来自外界的电磁波干扰
            - 减少相邻导线的电磁干扰
        - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%B8%B8%E7%94%A8%E7%9A%84%E7%BB%9E%E5%90%88%E7%BA%BF%E7%9A%84%E7%B1%BB%E5%88%AB%EF%BC%8C%E5%B8%A6%E5%AE%BD%E5%92%8C%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8.png)
        - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%8F%8C%E7%BB%9E%E7%BA%BF%E7%BB%9E%E5%90%88.png)
    - 同轴电缆
        - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%90%8C%E8%BD%B4%E7%94%B5%E7%BC%86%E7%9A%84%E7%BB%93%E6%9E%84.png)
        - 基带同轴电缆（50${\Omega}$）
            - 数字传输，过去用于局域网
        - 带宽同轴电缆（75${\Omega}$）
            - 模拟传输，目前主要用于有线电视
    - 光缆
        - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%85%89%E7%BA%A4%E6%95%B0%E6%8D%AE.png)
        - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%85%89%E7%BA%A4%E7%9A%84%E7%BB%84%E6%88%90%E6%9D%90%E6%96%99.png)
        - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%85%89%E7%BC%86%E4%BC%A0%E8%BE%93%E7%9A%84%E5%8E%9F%E7%90%86.png)
        - 光在纤芯中传输的方式是不断地全反射
        - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%A4%9A%E6%A8%A1%E5%85%89%E7%BA%A4%E4%B8%8E%E5%8D%95%E6%A8%A1%E5%85%89%E7%BA%A4.png)
    - 架空明线（铜线或铁线）
- 非导引型传输媒体
    - **传输媒体是指自由空间**
    - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E9%A2%91%E8%B0%B11.png)
    - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E9%A2%91%E8%B0%B12.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%BC%A0%E8%BE%93%E5%AA%92%E4%BD%93.png)

## 2.4 信道复用技术

复用

> 就是在一条传输媒体上同时传输多路用户的信号

原理

> 当一条传输媒体的传输容量大于多条信道传输的总容量时，就可以通过复用技术，在这条传输媒体上建立多条通信信道，以便充分利用传输媒体的带宽

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%8D%E7%94%A8.png)

### 频分复用FDM

- 用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带
- 所有用户在同样的时间占用不同的带宽资源
- 不够灵活
- ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/FDM.png)

### 时分复用TDM

- 将时间划分为一段段等长的时分复用帧（TDM帧）。每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙
- TDM信号也被称为等时信号
- 所有用户是在不同的时间占用同样的频带宽度
- 不够灵活
- 更有利于数字信号的传输

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E9%A2%91%E5%88%86%E5%A4%8D%E7%94%A8%E5%92%8C%E6%97%B6%E5%88%86%E5%A4%8D%E7%94%A8.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/TDM%E5%B8%A7%E4%B8%8E%E6%97%B6%E9%9A%99.png)

### 波分复用WDM

> 就是光的频分复用

原理

> 根据频分复用的设计思想，可在一根光纤上同时传输多个频率（波长）相近的光载波信号，实现基于光纤的频分复用技术 

密集波分复用DWDM

> 在一根光纤上复用几十路或更多路数的光载波信号

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%B3%A2%E5%88%86%E5%A4%8D%E7%94%A8%E7%9A%84%E6%A6%82%E5%BF%B5.png)

### 码分复用CDM

> 常被称为码分多址CDMA，他是在扩频通信技术的基础上发展起来的一种无线通信技术

- 每个用户可以在相同的时间使用相同的频带进行通信
- 最初用千军事通信，因为这种系统发送的信号有很强的抗干扰能力，其频谱类似千白噪声，不易被敌人发现。
- 现在已广泛使用在民用的移动通信中，特别是在无线局域网中。

------

工作原理

- CDMA将每个比特时间划分为m个更短的时间片，称为码片。m的取值通常为64或128

- CDMA中的每个站点都被指派一个唯一的m比特码片序列

    - 某个站要发送比特1，则发送它自己的m比特码片序列
    - 某个站要发送比特0，则发送它自己的m比特码片序列的反码

- 如果有两个或多个站同时发送数据，则信道中的信号就是这些站各自所发送一系列码片序列或码片序列反码的叠加。为了从信道中分离出各个站的信号，给每个站指派码片序列时，必须遵循以下规则：

    - 分配给每个站的码片序列必须各不相同，实际常采用伪随机码序列
    - 分配给每个站的码片序列必须相互正交，即各码片序列相应的码片向量之间的规格化内积为0

    $$
    \bold{S} \cdot \bold{T} = \frac{1}{m}\sum_{i=1}^mS_iT_i = 0 \\
    \bold{S}：站S的码片向量 \\
    \bold{T}：其他任何站的码片向量 \\
    $$

    ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%AD%A3%E4%BA%A4%E4%BE%8B%E5%AD%90.png)

    规律

- 各码片序列相应的码片向量之间的规格化内积为0

- 任何一个码片向量和该码片向量自己的规格化内积都是1

- 一个码片向量和该码片向量的规格化内积值是${-1}$

------

区别

- 码分复用CDM是另一种共享信道的方法。实际上，由于该技术主要用于多址接入，人们更常用的名词是码分多址CDMA(Code Division Multiple Access)。
- 同理，频分复用FDM和时分复用TDM同样可用于多址接入，相应的名词是频分多址FDMA(Frequency Division Multiple Access)和时分多址TDMA(Time Division Multiple Access)。
- 复用和多址
    - 复用是将单一媒体的频带资源划分成很多子信道，这些子信道之间相互独立，互不干扰。从媒体的整体频带资源上看，每个子信道只占用该媒体频带资源的一部分。
    - 多址（更确切地应该称为多点接入）处理的是动态分配信道给用户。这在用户仅仅暂时性地占用信道的应用中是必须的，而所有的移动通信系统基本上都属于这种情况。相反，在信道永久性地分配给用户的应用中，多址是不需要的（对于无线广播或电视广播站就是这样）。
- 与FDM和TDM不同，CDM的每一个用户可以**在同样的时间使用同样的频带进行通信。**
- 由于**各用户使用经过特殊挑选的不同码型**，因此各用户之间**不会造成干扰**。
- CDM最初是用于军事通信的，因为这种系统所发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。

## 2.5 数字传输系统

## 2.6 宽带接入技术

### 2.6.1 ADSL技术

> 非对称数字用户线ADSL技术是用数字技术对现有的模拟电话用户线进行改造

标椎模拟电话信号的频带被限制在300~3400Hz的范围内，但用户线本身实际可通过的信号频率仍然超过1 MHz

ADSL技术就把0~4kHz低端频谱留给传统电话使用，而把原来没有被利用的高端频谱留给用户上网使用

ADSL的下行（从ISP到用户）带宽都远远大于上行（从用户到ISP）带宽

- ADSL的传输距离取决于数据率和用户线的线径，与其成正比
- ADSL所能得到的最高数据传输速率还与实际的用户线上的信噪比密切相关

------

ADSL的特点

- ADSL在用户线两端各安装一个ADSL调制解调器
- 我国目前采用的ADSL方案是离散多音调DMT调制技术
- 不能保证固定的数据率

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/DMT%E6%8A%80%E6%9C%AF%E7%9A%84%E9%A2%91%E8%B0%B1%E5%88%86%E5%B8%83.png)

> 数字用户线接入复用器DSLAM
>
> ADSL调制解调器又被称为接入端单元ATU

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%9F%BA%E4%BA%8EADSL%E7%9A%84%E7%BB%84%E6%88%90%E7%BD%91.png)

### 2.6.2 光纤同轴混合网（HFC网）

> HFC网是在目前覆盖面很广的有线电视网CATV的基础上开发的一种居民宽带接入网，
>
> 除可传送电视节目外，还能提供电话、数据和其他宽带交互型务。
>
> 最早的有线电视网是树形拓扑结构的同轴电缆网络，它采用模拟技术的频分复用对电视节目进行单向广播传输。但以后有线电视网进行了改造，成
> 了现在的光纤同轴混合网(HFC 网）

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/HFC%E7%BD%91%E7%9A%84%E7%BB%93%E6%9E%84%E5%9B%BE.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%88%91%E5%9B%BD%E7%9A%84HFC%E7%BD%91%E7%9A%84%E9%A2%91%E5%B8%A6%E5%88%92%E5%88%86.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/HFC%E7%BD%91%E6%9B%B9%E5%8B%87%E8%8A%82%E7%82%B9%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png)

### 2.6.3 FTTx技术

- 光纤到户FTTH

- 无源光网络PON

    - > 光线路终端OLT

    - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%97%A0%E6%BA%90%E5%85%89%E9%85%8D%E7%BA%BF%E7%BD%91%E7%9A%84%E7%BB%84%E6%88%90.png)

## 传输方式

- 串行传输
    - 数据是一个比特一个比特依次发送的，因此在发送端与接收端之间，只需要一条数据传输线路即可
- 并行传输
    - 一次发送n个比特，因此，在发送端和接收端之间需要有n条传输线路
    - 并行传输的优点是比串行传输的速度n倍，但成本高
- 同步传输
    - 数据块以稳定的比特流的形式传输。字节之间没有间隔
    - 接收端在每个比特信号的中间时刻进行检测，以判别接收到的是比特0还是比特1
    - 由于不同设备的时钟频率存在一定差异，不可能做到完全相同，在传输大量数据的过程中，所产生的判别时刻的累计误差，会导致接收端对比特信号的判别错位
    - 要使收发双方保持同步的方法
        - 外同步
            - 在收发双方之间添加一条单独的时钟信号线
        - 内同步
            - 发送端将时钟同步信号编码到发送数据中一起传输
- 异步传输
    - 以字节为独立的传输单位，字节之间的时间间隔不是固定
    - 接收端仅在每个字节的起始处对字节内的比特实现同步
    - 通常在每个字节前后分别加上起始位和结束位

# 第三章 数据链路层

数据链路层使用的信道

- 点对点信道
- 广播信道
    - 使用专用的共享信道来协调这些主机的数据发送

## 3.1 数据链路和帧

每一种链路层协议都规定了所能传送的帧的数据部分长度上限——最大的传送单元MTU

### 3.1.1 数据链路和帧

链路

> 从一个结点到相邻结点的一端物理线路（有线或无线），中切没有任何其它的交换点。是一条路径的组成部分

- 链路也可以分为
    - 物理链路
    - 逻辑链路
        - ${物理链路+必要的通信协议}$

数据链路

> 由实现通信协议的硬件，软件和链路组成

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E9%80%82%E9%85%8D%E5%99%A8%E7%9A%84%E5%B1%82%E6%95%B0.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%BD%BF%E7%94%A8%E7%82%B9%E5%AF%B9%E7%82%B9%E4%BF%A1%E9%81%93%E7%9A%84%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82.png)

点对点信道的数据链路层在进行通信时的主要步骤如下：

1. 结点A的数据链路层把网络层交下来的IP数据报添加首部和尾部封装成帧
2. 结点A把封装好的帧发送给结点B的数据链路层
3. 若结点B的数据链路层收到的帧无差错，则从收到的帧中提取出IP数据报交给上面的网络层；否则丢弃这个帧

### 3.1.2 三个基本问题

#### 封装成帧

> 在一段数据的前后分别添加首部和尾部，从而构成了一个帧

- 帧头和帧尾中包含有重要的控制信息
- 帧头和帧尾的作用之一就是帧定界

​	![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%B0%81%E8%A3%85%E6%88%90%E5%B8%A7.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%B8%A7%E7%9A%84%E6%A0%BC%E5%BC%8F.png)

------

#### 透明传输

> 指数据链路层对上层交付的传输数据没有任何限制，就好像数据链路层不存在一样

- 面向字节的物理链路使用字节填充（或称字符填充）的方法实现透明传输
    - 在EOT和ESC前面插入一个ESC
- 面向比特的物理链路使用比特填充的方法实现透明传输
    - 每五个连续的1后面添加一个0

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%B7%AE%E9%94%99EOT.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%A1%AB%E5%85%85ESC.png)

------

#### 差错检测

> 实际的通信链路都不是理想的，比特在传输过程中可能会产生差错：1可能变成0,0也可能变成1，这称为比特差错
>
> FCS字段的值（检测码）

- 在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率BER

- 检错码只能检错出帧在传输过程中出现了茶卒，但并不能定位错误，因此无法纠正错误

- 目前广泛采用循环冗余检验CRC的检错技术

    - 收发方约定好一个**生成多项式${G(x)}$**
    - 发送方基于待发送的数据和生成多项式计算出差错检测吗（冗余码），将其添加到待传输数据的后面一起传输
    - 接收方通过生成多项式来计算收到的数据是否产生了误码 

    ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/CRC.png)

    ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E7%94%9F%E6%88%90%E5%A4%9A%E9%A1%B9%E5%BC%8F.png)

    ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/CRC%E8%AE%A1%E7%AE%97%E4%BD%99%E6%95%B0.png)

    ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/CRC%E6%A3%80%E6%B5%8B%E4%BC%A0%E8%BE%93%E6%98%AF%E5%90%A6%E8%AF%AF%E7%A0%81.png)

- 奇偶校验

    - 在待发送的数据后面**添加1位奇偶校验位**，使整个数据（包括添加的校验位在内）中**“1”的个数**位奇数（奇校验）或偶数（偶校验）
    - 奇校验
        - 添加比特1
        - 1的数量为奇数时，无法检验出错误
        - 1的数量为偶数时，可以检验出错误
    - 偶校验
        - 添加比特0
        - 0的数量为偶数时，无法检验出错误
        - 0的数量为奇数时，可以检验出错误

#### 可靠传输

当检测出帧中出现了比特差错后所采取的措施取决于数据链路层向上层提供的服务类型

- 不可靠传输服务
    - 仅仅丢弃有误码的帧，其它什么也不做
- 可靠传输服务
    - 想办法实现发送端发送什么，接收端就收到什么

------

- 一般情况下，**有限链路**的误码率比较低，为了减小开销，并**不要求数据链路层**向上提供**可靠**传输服务。即使出现了误码，可靠传输的问题也由其上层处理
- **无线链路**易受干扰，误码率比较高，因此**要求数据链路层**必须向上层提供**可靠**传输服务
- **比特差错**只是传输差错的一种
- 从整个体系网络结构来看，传输差错还包括**分组丢失，分组失序以及分组重复**，这三个一般不会出现在数据链路层，而会出现在其上层，因此各层均可选择实现可靠传输

------

##### 停止-等待协议SW

- 接收端检测到数据分组有误时，将其丢弃并等待发送方的超时重传。但对于误码率较高的点对点链路，为使发送发**尽早重传**，也可**个发送方发送NAK（否认）分组**
- 为了让接收方能够判断所收到的数据是否重复的，需要给**数据分组编号**。由于停止=等待协议的停等特性，**只需1个比特编号**就够了，即编号0和1
- 为了让发送方能够判断所收到的ACK（确认）分组是否是重复的，需要给**ACK分组编号**,所以比特数量**与数据分组编号所用比特数量一样**。数据链路层一般不会出现ACK分组迟到的情况，因此在**数据链路层实现停止-等待协议可以不用给ACK分组编号**
- 超时计时器设置的**重传时间**应仔细选择。一般将重传时间选为**略大于"从发方放到接收方的平均往返时间"**
    - 在数据链路层点对点的往返时间比较确定，重传时间比较好设定
    - 然而在运输层，由于端到端往返时间非常不确定，设置合适的重传时间有时并不容易 

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/SW%E8%BF%87%E7%A8%8B.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E7%A1%AE%E8%AE%A4%E6%95%B0%E6%8D%AE%E5%88%86%E7%BB%84%E6%98%AF%E5%90%A6%E9%87%8D%E5%A4%8D.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/SW%E7%A1%AE%E8%AE%A4%E8%BF%9F%E5%88%B0.png)

------

信道利用率

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/SW%E7%9A%84%E4%BF%A1%E9%81%93%E5%88%A9%E7%94%A8%E7%8E%87.png)

- 当往返时延RTT远大于数据帧发送时延${T_D}$时（例如使用卫星链路），信道利用率非常低
- 若出现重传，则对于传送有用的数据信息来说，信道利用率还要降低
- 为了克服SW，就产生了GBN和SR

##### 回退N帧协议GBN

> GBN协议在流水线传输的基础上利用发送窗口来限制发送发连续发送的数据分组的数量，是一种连续ARQ协议

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/GNU.png)

- 采用3个比特给分组编序号，即序号0~7
- 发送窗口的尺寸${W_T}$的取值：${1<W_T\le2^{3-1}}$
    - 当${W_T}$的值为1，则与SW协议相同
- 接收窗口的尺寸${W_R}$的取值：$W_R=1$
- 累计确认
    - 接收方**不一定**要对收到的数据分组**逐个发送确认**，而是可以在收到几个数据分组后（由具体实现决定），**对按序到达的最后一个数据分组发送确认**。ACKn表示序号为n及以前的所有数据分组都已正确接收
    - 即使确认分组丢失，发送方也可能不必重传
    - 发送方收到重复的确认，就知道之前所发送的数据分组出现了差错，于是可以不等超时计时器超时就立刻重传（至于收到几个重复确认就立刻重传，由具体实现决定） 

##### 选择重传协议SR

> 回退N帧协议的接收窗口尺寸$W_R$只能等于1，因此接收方只能按序接收正确到达的数据分组
>
> 一个数据分组的误码就会导致其后续多个数据分组不能被接收方按序接收而丢弃，必然会造成发送方对这些数据分组的超时重传，对通信资源造成了极大的浪费
>
> 
>
> 因此${W_R\ge1}$,以便**接收方先收下失序到达但无误码并且序号落在接收窗口内的那些数据分组**，等到所缺分组收齐后在一并送气上层，这就是选择重传协议

- 采用3个比特给分组编序号，即序号0~7
- 发送窗口的尺寸${W_T}$的取值：${1<W_T\le2^{3-1}}$
    - 当${W_T}$的值为1，则与GBN协议相同
- 接收窗口的尺寸${W_R}$的取值：$W_R=W_T$

------

- 发送方的发送窗口尺寸$W_T$必须满足：${1<W_T\le2^{n-1}}$,其中n是构成分组序号的比特数量
    - 当${W_T}$的值为1，则与SW协议相同
    - 若${W_T>2^{n-1}}$：造成接收方无法分辨新，旧数据分组的问题
- 接收方的接收窗口尺寸$W_R$必须满足：${1<W_R\le W_T}$,其中n是构成分组序号的比特数量
    - 当${W_T}$的值为1，则与GBN协议相同
    - 若${W_R>W_T}$：无意义

## 3.2 点对点协议PPP

目前使用最广泛的点对点数据链路协议

> 高级数据链路控制HDLC



### 3.2.1 PPP协议的特点

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E7%94%A8%E6%88%B7%E5%88%B0ISP%E4%BD%BF%E7%94%A8PPP%E5%8D%8F%E8%AE%AE.png)

PPP协议应满足的要求

- 简单

    - 对数据链路层的帧，不需要纠错，不需要序号，也不需要流量控制
    - 接收方每收到一个帧，就进行CRC 检验。如CRC 检验正确，就收下这个帧；反之，就丢弃这个帧，其他什么也不做。

- 封装成帧

    - PPP 协议必须规定特殊的字符作为帧定界符（即标志一个帧的开始和结束的字符），以便使接收端从收到的比特流中能准确地找出帧的开始和结束位置。

- 透明性

    - PPP 协议必须保证数据传输的透明性。

- 多种网络层协议

    - PPP 协议必须能够在在同一条物理链路上同时支持多种网络层协议（如IP 和IPX 等）的运行。
    - 当点对点链路所连接的是局域网或路由器时， PPP 协议必须同时支持在链路所连接的局域网或路由器上运行的各种网络层协议。、

- 多种类型链路

    - PPP 还必须能够在多种类型的链路上运行。

- 差错检测

    - PPP 协议必须能够对接收端收到的帧进行检测，并立即丢弃有差错的帧。

- 检测连接状态

    - PPP 协议必须具有一种机制能够及时（不超过几分钟）自动检测出链路是否处千正常工作状态。

- 最大传送单元

    - PPP协议必须对每一种类型的点对点链路设置最大传送单元的标准默认值气

        > MTU是数据链路层的帧可以载荷的数据部分的最大长度，而不是帧的总长度。

- 网络层地址协商

    - PPP 协议必须提供一种机制使通信的两个网络层（例如，两个IP 层）的实体能够通过协商知道或能够配置彼此的网络层地址。

- 数据压缩状态

    - PPP 协议必须提供一种方法来协商使用数据压缩算法。

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/PPP%E5%8D%8F%E8%AE%AE%E5%BA%94%E6%BB%A1%E8%B6%B3%E7%9A%84%E8%A6%81%E6%B1%82.png)

PPP协议的组成

- 一个将IP 数据报封装到串行链路的方法。
    - PPP 既支待异步链路（无奇偶检验的8 比特数据）
    - 也支持面向比特的同步链路。
    - IP 数据报在PPP 帧中就是其信息部分。这个信息部分的长度受最大传送单元MTU 的限制。
- 一个用来建立、配置和测试数据链路连接的链路控制协议LCP (Link Control Protocol)
- 一套网络控制协议NCP(Network Control Protocol)
    - 其中的每一个协议支持不同的网络层协议，

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/PPP%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%BB%84%E6%88%90.png)

### 3.2.2 PPP协议的帧格式

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/PPP%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B8%A7%E6%A0%BC%E5%BC%8F.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/PPP%E5%B8%A7%E7%9A%84%E6%A0%BC%E5%BC%8F.png)

> 标志字段表示一个帧的开始或结束。因此标志字段就是PPP 帧的定界符。连续两帧之间只需要用一个标志字段。如果出现连续两个标志字段，就表示这是一个空帧，应当丢弃。

> PPP 首部的第四个字段是2 字节的协议字段。
>
> - 当协议字段为Ox0021 时， PPP 帧的信息字段就是IP 数据报。
>
> - 若为OxC021, 则信息字段是PPP 链路控制协议LCP 的数据，
>
> - 而Ox8021 表示这是网络层的控制数据气

------

字节填充

当PPP 使用异步传输时，它把转义符定义为Ox7D （即01111101) ，并使用字节填充，

- 把信息字段中出现的每一个Ox7E 字节转变成为2 字节序列(Ox7D, Ox5E) 。
    - $0X7E \rightarrow 0X7D,0X5E$
    - 7E前面插入7D，并且把7E-0x20,由此得到7D，5E
- 若信息字段中出现一个Ox7D 的字节（即出现了和转义字符一样的比特组合），则
    把Ox7D 转变成为2 字节序列(Ox7D, Ox5D) 。
    - $0X7D \rightarrow 0X7D,0X5D$
    - 7D前面插入7D，并且把7D-0x20,由此得到7D，5D
- 若信息字段中出现ASCII 码的控制字符（即数值小千Ox20 的字符），则在该字符前
    面要加入一个Ox7D 字节，同时将该字符的编码加以改变。例如，出现Ox03 （在控制字符中是“传输结束“ETX) 就要把它转变为2 字节序列(Ox7D, Ox23) 。
    - 控制字符（小于0X20)前面加0X7D，同时将该控制字符**加上0x20**

零比特填充

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E9%9B%B6%E6%AF%94%E7%89%B9%E7%9A%84%E5%A1%AB%E5%85%85%E4%B8%8E%E5%88%A0%E9%99%A4.png)

### 3.2.3 PPP协议的工作状态

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/PPP%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%8A%B6%E6%80%81%E5%9B%BE.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/PPP%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%8A%B6%E6%80%81.png)

## 3.3 使用广播信道的数据链路层

### 3.3.1 局域网的数据链路层

局域网

- 主要特点
    - 网络为一个单位所拥有，且地理范围和站点数目均有限
- 优点
    - 具有广播功能，从一个站点可很方便地访问全网。
    - 便千系统的扩展和逐渐演变，各设备的位置可灵活调整和改变。
    - 提高了系统的可靠性(reliability) 、可用性(availability)和生存性(survivability) 。

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%AA%92%E4%BD%93%E6%8E%A5%E5%85%A5%E6%8E%A7%E5%88%B6.png)

------

### 媒体接入控制

#### 2.4 信道复用技术

复用

> 就是在一条传输媒体上同时传输多路用户的信号

原理

> 当一条传输媒体的传输容量大于多条信道传输的总容量时，就可以通过复用技术，在这条传输媒体上建立多条通信信道，以便充分利用传输媒体的带宽

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%8D%E7%94%A8.png)

#### 频分复用FDM

- 用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带
- 所有用户在同样的时间占用不同的带宽资源
- 不够灵活
- ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/FDM.png)

#### 时分复用TDM

- 将时间划分为一段段等长的时分复用帧（TDM帧）。每一个时分复用的用户在每一个TDM帧中占用固定序号的时隙
- TDM信号也被称为等时信号
- 所有用户是在不同的时间占用同样的频带宽度
- 不够灵活
- 更有利于数字信号的传输

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E9%A2%91%E5%88%86%E5%A4%8D%E7%94%A8%E5%92%8C%E6%97%B6%E5%88%86%E5%A4%8D%E7%94%A8.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/TDM%E5%B8%A7%E4%B8%8E%E6%97%B6%E9%9A%99.png)

#### 波分复用WDM

> 就是光的频分复用

原理

> 根据频分复用的设计思想，可在一根光纤上同时传输多个频率（波长）相近的光载波信号，实现基于光纤的频分复用技术 

密集波分复用DWDM

> 在一根光纤上复用几十路或更多路数的光载波信号

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%B3%A2%E5%88%86%E5%A4%8D%E7%94%A8%E7%9A%84%E6%A6%82%E5%BF%B5.png)

#### 码分复用CDM

> 常被称为码分多址CDMA，他是在扩频通信技术的基础上发展起来的一种无线通信技术

- 每个用户可以在相同的时间使用相同的频带进行通信
- 最初用千军事通信，因为这种系统发送的信号有很强的抗干扰能力，其频谱类似千白噪声，不易被敌人发现。
- 现在已广泛使用在民用的移动通信中，特别是在无线局域网中。

------

工作原理

- CDMA将每个比特时间划分为m个更短的时间片，称为码片。m的取值通常为64或128

- CDMA中的每个站点都被指派一个唯一的m比特码片序列

    - 某个站要发送比特1，则发送它自己的m比特码片序列
    - 某个站要发送比特0，则发送它自己的m比特码片序列的反码

- 如果有两个或多个站同时发送数据，则信道中的信号就是这些站各自所发送一系列码片序列或码片序列反码的叠加。为了从信道中分离出各个站的信号，给每个站指派码片序列时，必须遵循以下规则：

    - 分配给每个站的码片序列必须各不相同，实际常采用伪随机码序列
    - 分配给每个站的码片序列必须相互正交，即各码片序列相应的码片向量之间的规格化内积为0

    $$
    \bold{S} \cdot \bold{T} = \frac{1}{m}\sum_{i=1}^mS_iT_i = 0 \\
    \bold{S}：站S的码片向量 \\
    \bold{T}：其他任何站的码片向量 \\
    $$

    ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%AD%A3%E4%BA%A4%E4%BE%8B%E5%AD%90.png)

    规律

- 各码片序列相应的码片向量之间的规格化内积为0

- 任何一个码片向量和该码片向量自己的规格化内积都是1

- 一个码片向量和该码片向量的规格化内积值是${-1}$

------

#### 区别

- 码分复用CDM是另一种共享信道的方法。实际上，由于该技术主要用于多址接入，人们更常用的名词是码分多址CDMA(Code Division Multiple Access)。
- 同理，频分复用FDM和时分复用TDM同样可用于多址接入，相应的名词是频分多址FDMA(Frequency Division Multiple Access)和时分多址TDMA(Time Division Multiple Access)。
- 复用和多址
    - 复用是将单一媒体的频带资源划分成很多子信道，这些子信道之间相互独立，互不干扰。从媒体的整体频带资源上看，每个子信道只占用该媒体频带资源的一部分。
    - 多址（更确切地应该称为多点接入）处理的是动态分配信道给用户。这在用户仅仅暂时性地占用信道的应用中是必须的，而所有的移动通信系统基本上都属于这种情况。相反，在信道永久性地分配给用户的应用中，多址是不需要的（对于无线广播或电视广播站就是这样）。
- 与FDM和TDM不同，CDM的每一个用户可以**在同样的时间使用同样的频带进行通信。**
- 由于**各用户使用经过特殊挑选的不同码型**，因此各用户之间**不会造成干扰**。
- CDM最初是用于军事通信的，因为这种系统所发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。

### 3.3.2 CSMA/CD协议

##### 随机接入

> 载波监听多址接入/碰撞检测CSMA/CD(Carrier Sense Multiple Access/Collision Detection)

- 多址接入MA
    - 多个站连接在一条总线上，竞争使用总线
- 载波监听CS
    - 每一个站在发送帧之前先要检测一下总线上是否有其它站点在发送帧（“先听后说”）
        - 若检测到总线空闲96比特时间，则发送这个帧
        - 若检测到总线忙，则继续检测并等待总线转为空闲96比特时间，然后发送这个帧
- 碰撞检测CD
    - 每一个正在发送帧的站边发送变检测碰撞（“边说边听”）
        - 一旦发现总线上出现碰撞，则立即停止发送，退避一段随机时间后再次发送（“一旦冲突，立即停说，等待时机，重新再说”）。 

#### 争用期（碰撞窗口）

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/CSMACD%E4%BA%89%E7%94%A8%E6%9C%9F-%E7%A2%B0%E6%92%9E%E7%AA%97%E5%8F%A3.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%BC%A0%E6%92%AD%E6%97%B6%E5%BB%B6%E5%AF%B9%E8%BD%BD%E6%B3%A2%E7%9B%91%E5%90%AC%E7%9A%84%E5%BD%B1%E5%93%8D.png)

- 主机最多经过${2\tau(即\delta\to0)}$的时长就可检测到本次发送是否遭受了碰撞
- 因此，以太网的端到端往返传播时延$2\tau$称为**争用期**或**碰撞窗口**
- 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。
- 每一个主机在自己发送帧之后的一小段时间内，存在着遭遇碰撞的可能性。这一小段时间是不确定的。它取决于另一个发送帧的主机到本主机的距离，但不会超过总线的端到端往返传播时延，即一个争用期时间。
- 显然，在以太网中发送帧的主机越多，端到端往返传播时延越大，发生碰撞的概率就越大。因此，**共享式以太网不能连接太多的主机，使用的总线也不能太长。**
    - 10Mb/s以太网把争用期定为512比特发送时间，即51.2us，因此其总线长度不能超过5120m，但考虑到其他一些因素，如信号衰减等，以太网规定总线长度不能超过2500m。

------

#### 最小帧长

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%9C%80%E5%B0%8F%E5%B8%A7%E9%95%BF.png)

- **以太网规定最小帧长为64字节**，即512比特（512比特时间即为争用期）
    - 如果发送的数据非常少，那么必须加入一些字节填充，使帧长不小于64字节
- 以太网的**最小帧长确保了主机可在帧发送完成之前就检测到该帧的发送过程中是否遭遇了碰撞**
    - 如果在争用期（共发送64字节）没有检测到碰撞，那么后续发送的数据就一定不会发生碰撞；
    - 如果在争用期内检测到碰撞，就立即中止发送，这时已经发送出去的数据一定小于64字节，因此**凡长度小于64字节的帧都是由于碰撞而异常中止的无效帧。**

#### 截断二进制指数退避算法

$$
电磁波在1km电缆的传播时约为5{\mu}s \\
总线上的单程端到端传播时延记为\tau \\
争用期时间是51.2{\mu}s \\
基本退避时间：争用期2\tau \\
随机数r：r从离散的整数集合\{0,1,...,(2^k-1)\}中随机选出一个数 \\
k=Min[重传次数，10] \\
退避时间 = 基本退避时间 \times 随机数r
$$

 ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%88%AA%E6%96%AD%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%8C%87%E6%95%B0%E9%80%80%E9%81%BF%E7%AE%97%E6%B3%95%E4%BE%8B%E5%AD%90.png)

- 若连续多次发生碰撞，就表明可能有较多的主机参与竞争信道。但使用上述退避算法可**使重传需要推迟的平均时间随重传次数而增大**（这也称为**动态退避**），因而**减小发生碰撞的概率**，有利于整个系统的稳定。
- **当重传达16次仍不能成功时**，表明同时打算发送帧的主机太多，以至于连续发生碰撞，则**丢弃该帧**，并向高层报告。

#### 强化碰撞

> 是当发送数据的站一旦发现发生了碰撞时，除了立即停止发送数据外，还要再继续发送32 比特或48 比特的**人为干扰信号Gamming signal)** ，以便让所有用户都知道现在已经发生了碰撞

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%BA%BA%E4%B8%BA%E5%B9%B2%E6%89%B0%E4%BF%A1%E5%8F%B7%E7%9A%84%E5%8A%A0%E5%85%A5.png)

以太网还规定了帧间最小间隔为9.6 μs, 相当于96 比特时间。这样做是为了使刚刚收
到数据帧的站的接收缓存来得及清理，做好接收下一帧的准备。



CSMA/CD 协议的要点归纳如下：

1. 准备发送：适配器从网络层获得一个分组，加上以太网的首部和尾部，组成以太网帧，放入适配器的缓存中。但在发送之前，必须**先检测信道**。
2. 检测信道：若检测到信道忙，则应不停地检测，一直等待信道转为空闲。若检测到
    信道空闲，并在96 比特时间内信道保持空闲（保证了帧间最小间隔），就发送这个帧。
3. 在发送过程中仍不停地检测信道，即网络适配器要**边发送边监听**。这里只有两种可
    能性：
    1. 发送成功：在争用期内一直未检测到碰撞。这个帧肯定能够发送成功。发送完毕后，其他什么也不做。然后回到(1) 。
    2. 发送失败：在争用期内检测到碰撞。这时立即停止发送数据，并按规定发送人为干扰信号。适配器接着就执行指数退避算法，等待r 倍512 比特时间后，返回到步骤(2) ，继续检测信道。但若重传达16 次仍不能成功，则停止重传而向上报错。

### CSMA/CA协议

> 载波监昕多址接入/碰撞避免CSMA/CA(Carrier Sense Multiple Access/Collision Avoidance)

- **在无线局域网中，仍然可以使用载波监听多址接入CSMA**，即在发送帧之前先对传输媒体进行载波监听。若发现有其他站在发送帧，就推迟发送以免发生碰撞。

- **在无线局域网中，不能使用碰撞检测CD**，原因如下：
    - 由于无线信道的传输条件特殊，其信号强度的动态范围非常大，无线网卡上接收到的信号强度往往会远远小于发送信号的强度（可能相差百万倍）。**如果要在无线网卡上实现碰撞检测CD，对硬件的要求非常高。**
    - 即使能够在硬件上实现无线局域网的碰撞检测功能，但由于无线电波传播的特殊性**（存在隐蔽站问题），进行碰撞检测的意义也不大。**
- **802.11无线局域网**使用CSMA/CA协议，在CSMA的基础上增加了一个**碰撞避免CA功能**，而不再实现碰撞检测功能。
- 由于**不可能避免所有的碰撞**，并且**无线信道误码率较高**，802.11标准还使用了**数据链路层确认机制（停止-等待协议）**来保证数据被正确接收。
- 802.11的MAC层标准定义了两种不同的媒体接入控制方式：
    - **分布式协调功能DCF**(Distributed Coordination Function)。在DCF方式下，没有中心控制站点，每个站点使用CSMA/CA协议通过争用信道来获取发送权，这是802.11定义的默认方式。
    - **点协调功能PCF**(Point Coordination Function)。PCF方式使用集中控制的接入算法（一般在接入点AP实现集中控制），是802.11定义的可选方式，在实际中较少使用。

#### 帧间间隔IFS(InterFrame Space)

- 802.11标准规定，所有的**站点必须在持续检测到信道空闲一段指定时间后才能发送帧**，这段时间称为帧间间隔IFS
- 帧间间隔的长短取决于该站点要发送的帧的类型：
    - 高优先级帧需要等待的时间较短，因此可优先获得发送权
    - 低优先级帧需要等待的时间较长。若某个站的低优先级帧还没来得及发送，而其他站的高优先级帧已发送到信道上，则信道变为忙态，因而低优先级帧就只能再推迟发送了。这样就减少了发生碰撞的机会。
- 常用的两种帧间间隔如下：
    - **短帧间间隔SIFS**($28{\mu}s$)，是最短的帧间间隔，用来分隔开属于一次对话的各帧。一个站点应当能够在这段时间内从发送方式切换到接收方式。使用SIFS的帧类型有ACK帧、CTS帧、由过长的MAC帧分片后的数据帧、以及所有回答AP探询的帧和在PCF方式中接入点AP发送出的任何帧。
    - **DCF帧间间隔DIFS**（$128{\mu}s$)，它比短帧间间隔SIFS要长得多，在DCF方式中用来发送数据帧和管理帧。

#### CSMA/CA协议的工作原理

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/CA%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png)

- 当检测到信道是空闲的，并且所发送的数据帧不是成功发送完上一个数据帧之后立即连续发送的数据帧，则不适用退避算法
- 以下情况必须使用退避算发
    - 在发送数据帧之前坚持测到信道处于忙状态时
    - 在每一次重传一个数据帧时
    - 在每一次成功发送后要连续发送下一个数据帧时（这是为了避免一个站点长时间占用信道）

#### CSMA/CA协议的退避算法

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/CA%E5%8D%8F%E8%AE%AE%E7%9A%84%E9%80%80%E9%81%BF%E7%AE%97%E6%B3%95.png)

- 在执行退避算法时，站点为退避计时器设置一个随机的退避时间：
    - 当退避计时器的时间减小到零时，就开始发送数据
    - 当退避计时器的时间还未减小到零时而信道又转变为忙状态，这时就冻结退避计时器的数值，重新等待信道变为空闲，在经过时间DIFS后，继续启动退避计时器
- 2+i在进行第i次退避时，退避时间在时隙编号{0，1，…，$2^{i+1}-1$}中随机选择一个，然后乘以基本退避时间（也就是一个时隙的长度）就可以得到随机的退避时间。这样做是为了使不同站点选择相同退避时间的概率减少。当时隙编号达到255时（对应于第6次退避）就不再增加了。

#### CSMA/CA协议的信道预约和虚拟载波监听

- 为了**尽可能减少碰撞的概率**和降低碰撞的影响，802.11标准允许要发送数据的站点**对信道进行预约**。

    1. 源站在发送数据帧之前先发送一个短的控制帧，称为**请求发送RTS**（Request To Send），它包括源地址、目的地址以及这次通信（包括相应的确认帖） 所需的持续时间.
    2. 若目的站正确收到源站发来的RTS帧，且媒体空闲，就发送一个响应控制帧，称为**允许发送CTS(**Clear To Send)，它也包括这次通信所需的持续时间（从RTS帧中将此持续时间复制到CTS帧中）
    3. 源站收到CTS帧后，再等待一段时间SIFS后，就可发送其数据帧。
    4. 若目的站正确收到了源站发来的数据帧，在等待时间SIFS后，就向源站发送确认帧ACK。

- 除源站和目的站以外的**其他各站**，在**收到CTS帧（或数据帧）后就推迟接入到无线局域网中**。这样就保证了源站和目的站之间的通信不会受到其他站的干扰。

- 如果RTS帧发生碰撞，源站就收不到CTS帧，需执行退避算法重传RTS帧。

- 由于**RTS帧和CTS帧很短，发送碰撞的概率、碰撞产生的开销及本身的开销都很小**。而对于一般的数据帧，其发送时延往往大于传播时延（因为是局域网），碰撞的概率很大，且一旦发生碰撞而导致数据帧重发，则浪费的时间就很多，因此**用很小的代价对信道进行预约往往是值得的**。802.11标准规定了3种情况供用户选择：

    -  使用RTS帧和CTS帧
    - 不使用RTS帧和CTS帧
    - 只有当数据帧的长度超过某一数值时才使用RTS帧和CTS帧

    ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/CA%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%BF%A1%E9%81%93%E9%A2%84%E7%BA%A6%E5%92%8C%E8%99%9A%E6%8B%9F%E8%BD%BD%E6%B3%A2%E7%9B%91%E5%90%AC.png)

### 3.3.3 使用集线器的星形拓扑

集线器的特点

1. 使用集线器的以太网在逻辑上仍是一个总线网，各站共享逻辑上的总线，使用的还是CSMA/CD 协议（更具体些说，是各站中的适配器执行CSMNCD 协议）。网络中的各站必须竞争对传输媒体的控制，并且在同一时刻至多只允许一个站发送数据。
2. 一个集线器很像一个多接口的转发器。
3. 集线器工作在物理层，它的每个接口仅仅简单地转发比特——收到1 就转发1, 收到0 就转发o, 不进行碰撞检测。若两个接口同时有信号输入（即发生碰撞），那么所有的接口都将收不到正确的帧。

### 3.3.4 以太网的信道利用率

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%BB%A5%E5%A4%AA%E7%BD%91%E7%9A%84%E4%BF%A1%E9%81%93%E8%A2%AB%E5%8D%A0%E7%94%A8%E7%9A%84%E6%83%85%E5%86%B5.png)
$$
发送帧需要的时间是T_0 \\
T_0 = \frac{帧长(bit)}{发送速率(10 Mbit/s)} \\
a：以太网单程端到端时延\tau与帧的发送时间T_0之比:  a=\frac{\tau}{T_0} \\
发送一帧占用总线的时间为T_0+\tau \\
极限信道利用率：S_{max}=\frac{T_0}{T_0+\tau}=\frac{1}{1+a}
$$
![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%9E%81%E9%99%90%E4%BF%A1%E9%81%93%E5%88%A9%E7%94%A8%E7%8E%87.png)

帧发送流程;

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%B8%A7%E5%8F%91%E9%80%81%E6%B5%81%E7%A8%8B.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%B8%A7%E6%8E%A5%E6%94%B6%E6%B5%81%E7%A8%8B.png)

###  3.3.5 以太网的MAC层



## 3.4 扩展的以太网

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%B8%BB%E6%9C%BA%E4%BD%BF%E7%94%A8%E5%85%89%E7%BA%A4%E5%92%8C%E4%B8%80%E5%AF%B9%E5%85%89%E7%BA%A4%E8%B0%83%E5%88%B6%E8%A7%A3%E8%B0%83%E5%99%A8%E8%BF%9E%E6%8E%A5%E5%88%B0%E9%9B%86%E7%BA%BF%E5%99%A8.png)

- 光纤调制解调器
    - 进作用是进行电信号和光信号的转换

![ ](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E7%94%A8%E5%A4%9A%E4%B8%AA%E9%9B%86%E7%BA%BF%E5%99%A8%E8%BF%9E%E6%88%90%E6%9B%B4%E5%A4%A7%E7%9A%84%E4%BB%A5%E5%A4%AA%E7%BD%91.png)

- 在每一个碰撞域中只能有一个站在发送数据

- 网桥
    - 对收到的帧根据其MAC帧的目的进行转发和过滤
- 使用双绞线和集线器HUB的星型以太网
    - **使用集线器的以太网在逻辑上仍是一个总线网，**各专共享总线资源，**使用的还是CSMA/CD协议**
    - **集线器只工作在物理层，**它的每个接口仅简单地转发比特，不进行碰撞检测（由各站的网卡检测）
    - **集线器一般都有少量的容错能力和网络管理功能**。例如，若网络中某个网卡出了故障，不停地发送帧。此时，集线器可以检测到这个问题，在内部断开与出故障网卡的连线，使整个以太网仍然能正常工作。
- 以太网交换机
    - 以太网交换机通常都有**多个接口**。每个接口都可以直接与一台主机或另一个以太网交换机相连。一般都工作在**全双工方式**。
    - 以太网交换机具有并行性，能**同时连通多对接口**，使多对主机能同时通信，**无碰撞（不使用CSMA/CD协议）**。
    - 以太网交换机一般都具有多种速率的接口，例如：10Mb/s、100Mb/s、1Gb/s、10Gb/s接口的多种组合。
    - 以太网交换机**工作在数据链路层**（也包括物理层），它收到帧后，在帧交换表中查找**帧的目的MAC地址所对应的接口号**，然后通过该接口转发帧。
    - 以太网交换机是一种即插即用设备，其内部的**帧交换表**是通过**自学习算法**自动地逐渐建立起来的。
    - 帧的两种转发方式：
        - 1.存储转发
        - 2.直通交换：
            -  采用基于硬件的交叉矩阵(交换时延非常小，但不检查帧是否右差错）

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%AF%B9%E6%AF%94%E9%9B%86%E7%BA%BF%E5%99%A8%E5%92%8C%E4%BA%A4%E6%8D%A2%E6%9C%BA.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E9%9B%86%E7%BA%BF%E5%99%A8%E5%92%8C%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%80%BB%E7%BB%93.png)

------

> 以太网交换机自学习和转发帧的流程

- 以太网交换机工作在**数据链路层**（也包括物理层）
- 以太网交换机收到帧后，在帧交换表中查找**帧的目的MAC地址所对应的接口号**，然后通过该接口转发帧。
- 以太网交换机是一种即插即用设备，刚上电启动时其内部的帧交换表是空的。随着网络中各主机间的通信，以太网交换机通过**自学习算法**自动逐渐**建立起帧交换表**。

------

> 以太网交换机的生成树协议STP

- 如何提高以太网的可靠性？
    - 添加**冗余链路**可以提高以太网的可靠性
    - 但是，冗余链路也会带来负面效应——**形成网络环路**
    - 网络环路会带来以下问题：
        - 广播风暴
            - 大量消耗网络资源，使得网络无法正常转发其他数据帧；
        - 主机收到重复的广播帧大
            - 量消耗主机资源
        - 交换机的帧交换表震荡（漂移）
- 以太网交换机使用**生成树协议STP**(Spanning Tree Protocol),可以在增加冗余链路来提高网络可靠性的同时又**避免网络环路带来的各种问题**。
    - 不论交换机之间采用怎样的物理连接，交换机都能够**自动计算并构建一个逻辑上没有环路的网络**，其逻辑拓扑结构必须是树型的（无逻辑环路）；
    - 最终生成的树型逻辑拓扑要**确保连通整个网络**；
    - 当首次连接交换机或网络**物理拓扑发生变化**时（有可能是人为改变或故障），交换机都将进行**生成树的重新计算。**

## 3.5 虚拟局域网VLAN

### 概述

- 以太网交换机工作在**数据链路层**（也包括物理层）
- 使用一个或多个以太网交换机互连起来的交换式以太网，其所有站点都属于**同一个广播域**。
- 随着交换式以太网规模的扩大，广播域相应扩大。
- 巨大的广播域会带来很多**弊端**：
    - 广播风暴
    - 难以管理和维护
    - 潜在的安全问题
- **网络中会频繁出现广播信息**
    - TCP/IP协议栈中的很多协议都会使用广播：
        - 地址解析协议ARP（已知IP地址，找出其相应的MAC地址）
        - 路由信息协议RIP(一种小型的内部路由协议)
        - 动态主机配置协议DHCP（用于自动配置IP地址）
    - NetBEUI：Widnows下使用的广播型协议
    - IPX/SPX：Novell网络的协议栈
    - Apple Talk：Apple公司的网络协议栈
- 分割广播域的方法
    - 使用路由器
        - 成本较高
    - 虚拟局域网VLAN

> 虚拟局域网VLAN（Virtual Local Area Network)是一种将局域网内的**设备划分成与物理位置无关的逻辑组的技术，这些逻辑组具有某些共同的需求。**

### 实现机制

> 需要实现**IEEE 802.1Q帧**和**交换机的端口类型**

- IEEE 802.1Q帧（也称Dot One Q帧）对以太网的MAC帧格式进行了扩展，插入了**4字节的VLAN标记**。
    - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%8F%92%E5%85%A5VLAN%E6%A0%87%E8%AE%B0.png)
- VLAN标记的**最后12比特**称为**VLAN标识符VID**，它唯一地标志了以太网帧属于哪一个VLAN。
    - VID的取值范围是$(0\sim 2^{12}-1)$
    - 0和4095都不用来表示VLAN，因此用于表示VLAN的**VID的有效取值范围是1~4094**。
- **802.1Q帧是由交换机来处理的，而不是用户主机来处理的。**
    - 当交换机**收到普通的以太网帧**时，会将其插入4字节的VLAN标记转变为802.1Q帧，简称“**打标签**“
    - 当交换机**转发802.1Q帧**时，**可能**会删除其4字节VLAN标记转变为普通以太网帧，简称“**去标签**”

------

> 端口类型

- 交换机的端口类型有以下三种
    - Access
    - Trunk
    - Hybrid
- 交换机各端口的缺省VLAN ID
    - 在思科交换机上称为Native VLAN，即本征VLAN。
    - 在华为交换机上称为Port VLAN ID，即端口VLAN ID，简记为PVID。
- **Access端口**
    - Access端口一般用于连接用户计算机
    - Access端口只能属于一个VLAN
    - Access端口的PVID值与端口所属VLAN的ID相同（默认为1）
    - Access端口接收处理方法：
        - 一般只接受“未打标签”的普通以太网MAC帧。根据接收帧的端口的PVID给帧“**打标签**”，即插入4字节VLAN标记字段，字段中的VID取值与端口的PVID取值相等。
    - Access端口发送处理方法：
        - 若帧中的VID与端口的PVID相等，则“**去标签**”并**转发**该帧；否则不转发。
- **Trunk端口**
    - Trunk端口一般用于交换机之间或交换机与路由器之间的互连
    - Trunk端口可以属于多个VLAN
    - 用户可以设置Trunk端口的PVID值。默认情况下，Trunk端口的PVID值为1。
    - Trunk端口接收处理方法：
        - 对VID等于PVID的帧，**“去标签’“再转发**：
        - 对VID不等于PVID的帧，**直接转发**；
    - Trunk端口发送处理方法：
        - 接收“未打标签”的帧，根据接收帧的端口的PVID给帧“**打标签**”，即插入4字节VLAN标记字段，字段中的VID取值与端口的PVID取值相等。
        - 接收“已打标签的帧”
- **Trunk端口**
    - Hybrid端口既可用于交换机之间或交换机与路由器之间的互连（同Trunk端口），也可用于交换机与用户计算机之间的互连（同Access端口）
    - Hybrid端口可以属于多个VLAN（同Trun端口）用户可以设置Hybrid端口的PVID值。默认情况下，Hybrid端口的PVID值为1（同Trun端口）
    - Hybrid端口发送处理方法（与Trunk端口不同）查看帧的VID是否在端口的“去标签”列表中：
        - 若存在，则“去标签”后再转发；
        - 若不存在，则直接转发；
    - Hybrid端口接收处理方法（同Trunk端口）
        - 接收“未打标签”的帧，根据接收帧的端口的PVID给帧“打标签”，即插入4字节VLAN标记字段，字段中的VID取值与端口的PVID取值相等。
        - 接收“已打标签的帧”；

# 第四章 网络层

主要任务是**实现网络互联**，进而**实现数据包在各网络之间的传输**

## 4.1 网络层提供的两种服务

> 网络层向上只提供简单灵活的，无连接的，尽最大努力交付的数据报服务
>
> 网络层不提供服务质量的承诺

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E7%BD%91%E7%BB%9C%E5%B1%82%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%9C%8D%E5%8A%A1.png)

> 虚电路表示这只是一条逻辑上的连接，分组都沿着这条逻辑连接按照存储转发方式传送，而不是真正建立了一条物理连接

虚电路服务与数据报服务的主要区别

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E8%99%9A%E7%94%B5%E8%B7%AF%E6%9C%8D%E5%8A%A1%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AF%B9%E6%AF%94.png)

- 面向连接的虚电路服务
  - **可靠通信由网络来保证**
  - 必须建立**网络层的连接——虚电路VC(Virtual Circuit)**
  - 通信双方**沿着已建立的虚电路发生分组**
  - 目的主机的地址仅在连接建立阶段使用，之后每个**分组的首部只需携带一条虚电路的编号**(构成虚电路的每一段链路都有一个虚电路编号）。
  - **通信结束后，需要释放之前所建立的虚电路**
- 无连接的数据报服务
  - **可靠通信应当由用户主机来保证**
  - **不需要建立网络层连接**
  - **每个分组可走不同的路径**
  - 每个分组的**首部必须携带目的主机的完整地址**
  - 这种通信方式所传送的**分组可能误码，丢失，重复**和**失序**
  - 由于**网络本身不提供端到端的可靠传输服务**，这就使网络中的路由器可以做得比较简单，而且价格低廉（与电信网的交换机相比较）
  - 因特网采用了这种设计思想，也就是**将复杂的网络处理功能置于因特网的边缘（用户主机和其内部的运输层)**，而将相对简单的尽最大努力的分组交付功能置于因特网核心。

## 4.2 网际协议IP

与IP协议配套使用的三个协议：

- 地址解析协议ARP(Address Resolution Protocol)
- 网际控制协议ICMP(Internet Control Message Protocol)
- 网际组管理协议IGMP(Internet Group Management Protocol)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AEIP%E5%8F%8A%E5%85%B6%E9%85%8D%E5%A5%97%E5%8D%8F%E8%AE%AE.png)

### 4.2.1 虚拟互联网络

将网络互相连接起来要是用一些中间设备

中间设备

1. 物理层使用的中间设备叫做**转发器**
2. 数据链路层使用的中间设备叫做**网桥**或**桥接器**
3. 网络层使用的中间设备叫做**路由器**
4. 在网络层以上使用的中间设备叫做**网关**

### 4.2.2 分类的IP地址

IP地址的编址方法经过的三个阶段

1. **分类的IP地址**
2. **子网的划分**
3. **构成超网**

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/IP%E5%9C%B0%E5%9D%80%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C%E5%8F%B7%E5%AD%97%E6%AE%B5%E5%92%8C%E4%B8%BB%E6%9C%BA%E5%8F%B7%E5%AD%97%E6%AE%B5.png)

> 网络号：标志主机（或路由器）所连接到的网络，在互联网中是唯一的
>
> 主机号：标志该主机（或路由器），一台主机号在它前面的网络号所指明的网络范围内是唯一的

注意事项

> 只有A类、B类和C类地址可分配给网络中的主机或路由器的各接口
>
> 主机号为“全0”的地址是网络地址，不能分配给主机或路由器的各接口
>
> 主机号为“全1”的地址是广播地址，不能分配给主机或路由器的各接口

### 4.2.3 IP地址与硬件地址

- **IPv4地址**就是给因特网上的**每一台主机（或路由器）的每一个接口**分配一个在全世界范围内是**唯一的32比特的标识符**

#### MAC地址

MAC地址是以太网的MAC子层所使用的地址

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%BD%BF%E7%94%A8%E5%B9%BF%E6%92%AD%E4%BF%A1%E9%81%93%E7%9A%84%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E5%BF%85%E9%A1%BB%E4%BD%BF%E7%94%A8%E5%9C%B0%E5%9D%80%E6%9D%A5%E5%8C%BA%E5%88%86%E5%90%84%E4%B8%BB%E6%9C%BA.png)

- 当多个主机连接在同一个广播信道上，要想实现两个主机之间的通信，则每个主机都必须有一个唯一的标识，即一个数据链路层地址
- 在每个主机发送的**帧中必须携带标识发送主机和接收主机的地址**。由于这类地址是用于媒体接入控制MAC(Media Access Control),因此这类地址被称为**MAC地址**;
  - MAC地址一般被固化在网卡（网络适配器）的电可擦可编程只读存储器EEPROM中，因此MAC地址也被称为**硬件地址**
  - MAC地址有时也被称为**物理地址**。这并不意味着MAC地址属于网络体系结构中的物理层！
- 一般情况下，用户主机会包含两个网络适配器：有线局域网适配器（有线网卡）和无线局域网适配器（无线网卡）。每个网络适配器都有一个全球唯一的MAC地址。而交换机和路由器往往拥有更多的网络接口，所以会拥有更多的MAC地址。综上所述，**严格来说，MAC地址是对网络上各接口的唯一标识，而不是对网络上各设备的唯一标识。**

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/IEEE%20802%E5%B1%80%E5%9F%9F%E7%BD%91%E7%9A%84MAC%E5%9C%B0%E5%9D%80%E6%A0%BC%E5%BC%8F.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/MAC%E5%9C%B0%E5%9D%80%E7%9A%84%E7%B1%BB%E5%9E%8B.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/MAC%E5%9C%B0%E5%9D%80%E7%9A%84%E5%8F%91%E9%80%81%E9%A1%BA%E5%BA%8F.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%8D%95%E6%92%ADMAC%E5%9C%B0%E5%9D%80%E4%BE%8B%E5%AD%90.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%B9%BF%E6%92%ADMAC%E5%9C%B0%E5%9D%80%E4%BE%8B%E5%AD%90.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%A4%9A%E6%92%ADMAC%E5%9C%B0%E5%9D%80%E4%BE%8B%E5%AD%90.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E4%BB%A5%E5%A4%AA%E7%BD%91V2%E7%9A%84MAC%E5%B8%A7%E6%A0%BC%E5%BC%8F.png)

#### IP地址

IP地址是TCP/IP体系结构网际层所使用的地址

- IP地址是因特网（Internet)上的主机和路由器所使用的地址，用于标识两部分信息：
  - **网络编号**：标识因特网上数以百万计的网络
  - **主机编号**：标识同一网络上不同主机（或路由器各接口）
- 在数据包的转发过程中，**源IP地址和目的IP地址始终保持不变**；而**源MAC地址和目的MAC地址逐段链路（或逐个网络）改变**。
  - ![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E6%95%B0%E6%8D%AE%E5%8C%85%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%ADIP%E5%9C%B0%E5%9D%80%E4%B8%8EMAC%E5%9C%B0%E5%9D%80%E7%9A%84%E5%8F%98%E5%8C%96%E6%83%85%E5%86%B5.png)

### 4.2.4 地址解析协议ARP

ARP协议属于TCP/IP体系结构的网际层，其作用是已知设备所分配到的IP地址，使用ARP协议可以通过该IP地址获取到设备的MAC地址；

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/ARP1.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/ARP.gif)

### 4.2.5 IP数据报的格式

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E6%A0%BC%E5%BC%8F.png)

**IP数据报首部的固定部分中的各字段**

- 版本
  - 占4 位，指IP 协议的版本。通信双方使用的IP 协议的版本必须一致。目前广泛使用的IP 协议版本号为4 （即1Pv4) 。关千以后要使用的1Pv6 （即版本6 的IP 协议），我们将在后面的4.6 节讨论。
- 首部长度
  - 占4 位，可表示的最大十进制数值是15 。请注意，首部长度字段所表示数的单位是32 位字(1 个32 位字长是4 字节）。因为IP 首部的固定长度是20 字节，因此首部长度字段的最小值是5 （即二进制表示的首部长度是0101) 。而当首部长度为最大值1111 时（即十进制数的15) ，就表明首部长度达到最大值15 个32 位字长，即60 字节。当IP 分组的首部长度不是4 字节的整数倍时，必须利用最后的填充字段加以填充。因此IP 数据报的数据部分永远在4 字节的整数倍时开始，这样在实现1P 协议时较为方便。首部长度限制为60 字节的缺点是有时可能不够用。但这样做是希望用户尽量减少开销。最常用的首部长度是20 字节（即首部长度为0101) ，这时不使用任何选项。
- 区分服务
  - 占8 位，用来获得更好的服务。这个字段在旧标准中叫做服务类型，但实际上一直没有被使用过。1998 年IETF 把这个字段改名为区分服务DS (DifferentiatedServices) 。只有在使用区分服务时，这个字段才起作用（见8.4.4 节）。在一般的情况下都不使用这个字段[RFC 2474, 3168, 3260] 。
- 总长度
  - 总长度指首部和数据之和的长度，单位为字节。总长度字段为16 位，因此数据报的最大长度为216 - 1 = 65535 字节。然而实际上传送这样长的数据报在现实中是极少遇到的。
- 标识(identification) 
  - 占16 位。IP 软件在存储器中维持一个计数器，每产生一个数据报，计数器就加l ，并将此值赋给标识字段。但这个“标识”并不是序号，因为IP 是无连接服务，数据报不存在按序接收的问题。当数据报由于长度超过网络的MTU 而必须分片时，这个标识字段的值就被复制到所有的数据报片的标识字段中。相同的标识字段的值使分片后的各数据报片最后能正确地重装成为原来的数据报。
- 标志(flag) 
  - 占3 位，但目前只有两位有意义。
  - 标志字段中的最低位记为MF (More Fragment) 。MF= 1 即表示后面”还有分片”的数据报。MF=O 表示这已是若干数据报片中的最后一个。
  - 标志字段中间的一位记为DF (Don't Fragment) ，意思是“不能分片”。只有当DF = 0 时才允许分片。
- 片偏移
  - 占13 位。片偏移指出：较长的分组在分片后，某片在原分组中的相对位置。也就是说，相对千用户数据字段的起点，该片从何处开始。片偏移以8 个字节为偏移单位。这就是说，每个分片的长度一定是8 字节(64 位）的整数倍。

### 4.2.6 IP层转发分组的流程

## 4.3 划分子网和构造超网

#### 划分子网

划分子网的IPv4地址

- **32比特的子网掩码可以表明分类IP地址的主机号部分被借用了几个比特作为子网号**
  - 子网掩码使用**连续的比特1来对应网络号和子网号**
  - 子网掩码使用**连续的比特0来对应主机号**
  - 将划分子网的**IPv4地址**与其相应的**子网掩码**进行**逻辑与运算**就可得到IPv4地址**所在子网的网络地址**
  - **默认的子网掩码是指在未划分子网的情况下使用的子网掩码**

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E9%80%BB%E8%BE%91%E4%B8%8E%E8%BF%90%E7%AE%97.png)

![](https://noclose-image.oss-cn-hangzhou.aliyuncs.com/img/%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E8%BF%90%E7%AE%97%E4%BE%8B%E5%AD%90.png)

### 无分类编址的IPv4地址

> 无分类间路由选择CIDR

CIDR

- CIDR使用“斜线记法”，或称CIDR记法。即在IPv4地址后面加上斜线“/”，在斜线后面写上网络前缀所占的比特数量。

![](D:/%E6%A1%8C%E9%9D%A2/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%B0%A2%E5%B8%8C%E4%BB%81%E7%89%88/images/%E7%BD%91%E7%BB%9C%E5%B1%82/CRDR.png)

- CIDR实际上是将网络前缀都相同的连续的IP地址组成一个“CIDR地址块"
- 只要知道CIDR地址块中的任何一个地址，就可以知道该地址块的全部细节
  - 地址块的最小地址
  - 地址块的最大地址
  - 地址块中的地址数量
  - 地址块聚合某类网络（A类，B类，C类）的数量
  - 地址掩码（子网掩码）

### 路由聚合（构造超网）

- 网络前缀越长，地址块越小，路由越具体
- 若路由器查表转发分组时发现有多条路由可选，则选择网络前缀最长的那条，这称为最长前缀匹配，
- 因为这样的路由更具体

### IPv4地址的应用规划

- 定长的子网掩码FLSM
  - 使用同一个子网掩码来划分子网
  - 每个子网所分配的IP地址数量相同，造成IP地址的浪费
- 变长的子网掩码VLSM
  - 使用不同的子网掩码来划分子网
  - 每个子网所分配的IP地址数量可以不同，尽可能减少对IP地址的浪费
